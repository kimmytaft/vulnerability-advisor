pipeline {
    agent any
    environment {
        TOKEN = credentials('va-token')
    }
    stages {
        stage('build') {
            steps {
                sh """
                #!/bin/bash

                CONTAINER='default/jenkins-75d99f5657-pl6hs/d3ae07e93b34bdb8cd8a94dd6329c99e79ac0b8a0593a2537b2d0bd962a7a778'
                VULNERABILITIES=`curl -k -s -XGET -H "Authorization: Bearer \${TOKEN}" "https://172.16.40.4:8443/va/api/get-report?namespace=\${CONTAINER}&access_group=default&source_type=container&report_type=vulnerability"`
                
                echo \${VULNERABILITIES}
                """
            }
        }
    }
}
