pipeline {
    agent any
    environment {
        TOKEN = credentials('va-token')
    }
    stages {
        stage('build') {
            steps {
                sh """
                #!/bin/bash

                CONTAINER='default/blue-orders-mysql-794b456cc8-2w45w/3a64e5f74bffdb98e0f305b80597df66b70317ffccb580c6c77c3175f0b77c8b'
                VULNERABILITIES=`curl -k -s -XGET -H "Authorization: Bearer \${TOKEN}" "https://172.16.40.4:8443/va/api/get-report?namespace=\${CONTAINER}&access_group=default&source_type=container&report_type=vulnerability"`
                
                echo \${VULNERABILITIES}

                docker ls
                """
            }
        }
    }
}
